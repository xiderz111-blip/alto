#!/bin/bash\n\n# Script de d√©ploiement automatique Alt0 vers HostPapa\necho \"üöÄ D√©ploiement automatique Alt0 vers HostPapa\"\necho \"============================================\"\n\n# Configuration interactive\nsetup_config() {\n    echo \"üìù Configuration du d√©ploiement\"\n    echo \"\"\n    \n    # Demander les informations HostPapa\n    read -p \"üåê Votre domaine HostPapa (ex: monsite.com): \" DOMAIN\n    read -p \"üë§ Nom d'utilisateur FTP HostPapa: \" FTP_USER\n    read -s -p \"üîí Mot de passe FTP HostPapa: \" FTP_PASS\n    echo \"\"\n    echo \"\"\n    \n    # D√©tecter le type d'h√©bergement\n    echo \"üîç Type d'h√©bergement HostPapa:\"\n    echo \"1. H√©bergement partag√© (Web hosting)\"\n    echo \"2. VPS/Serveur d√©di√©\"\n    read -p \"Choisissez votre type d'h√©bergement (1 ou 2): \" HOSTING_CHOICE\n    \n    if [ \"$HOSTING_CHOICE\" = \"1\" ]; then\n        HOSTING_TYPE=\"shared\"\n        echo \"üì¶ Configuration pour h√©bergement partag√©\"\n    else\n        HOSTING_TYPE=\"vps\"\n        echo \"üñ•Ô∏è Configuration pour VPS\"\n    fi\n    \n    # Sauvegarder la configuration\n    cat > .env.deploy << EOF\nHOSTPAPA_HOST=$DOMAIN\nHOSTPAPA_USER=$FTP_USER\nHOSTPAPA_PASS=$FTP_PASS\nHOSTING_TYPE=$HOSTING_TYPE\nREACT_APP_BACKEND_URL=https://$DOMAIN\nNODE_ENV=production\nEOF\n    \n    echo \"‚úÖ Configuration sauvegard√©e\"\n}\n\n# Installation des d√©pendances n√©cessaires\ninstall_dependencies() {\n    echo \"üì¶ Installation des d√©pendances...\"\n    \n    # Installer lftp pour l'upload FTP si n√©cessaire\n    if ! command -v lftp >/dev/null 2>&1; then\n        echo \"üîß Installation de lftp...\"\n        if command -v apt-get >/dev/null 2>&1; then\n            sudo apt-get update && sudo apt-get install -y lftp\n        elif command -v yum >/dev/null 2>&1; then\n            sudo yum install -y lftp\n        elif command -v brew >/dev/null 2>&1; then\n            brew install lftp\n        else\n            echo \"‚ö†Ô∏è Veuillez installer lftp manuellement\"\n            echo \"Ubuntu/Debian: sudo apt-get install lftp\"\n            echo \"CentOS/RHEL: sudo yum install lftp\"\n            echo \"macOS: brew install lftp\"\n            exit 1\n        fi\n    fi\n    echo \"‚úÖ D√©pendances install√©es\"\n}\n\n# Build de l'application\nbuild_app() {\n    echo \"üî® Build de l'application Alt0...\"\n    \n    source .env.deploy\n    \n    # Mettre √† jour l'URL du backend dans le .env.production\n    echo \"REACT_APP_BACKEND_URL=https://$HOSTPAPA_HOST\" > ../frontend/.env.production\n    echo \"GENERATE_SOURCEMAP=false\" >> ../frontend/.env.production\n    echo \"REACT_APP_VERSION=1.0.0\" >> ../frontend/.env.production\n    echo \"REACT_APP_ENVIRONMENT=production\" >> ../frontend/.env.production\n    \n    # Build selon le type d'h√©bergement\n    ./build-for-hostpapa.sh $HOSTING_TYPE\n    \n    echo \"‚úÖ Build termin√©\"\n}\n\n# Upload vers HostPapa\nupload_to_hostpapa() {\n    echo \"üì§ Upload vers HostPapa...\"\n    \n    source .env.deploy\n    \n    if [ \"$HOSTING_TYPE\" = \"shared\" ]; then\n        LOCAL_PATH=\"hostpapa-package\"\n        REMOTE_PATH=\"public_html\"\n    else\n        LOCAL_PATH=\"hostpapa-vps-package\"\n        REMOTE_PATH=\"alt0-app\"\n    fi\n    \n    # Upload via lftp\n    lftp -c \"\n        set ftp:ssl-allow no\n        set ftp:passive-mode on\n        set ftp:list-options -a\n        open ftp://$HOSTPAPA_USER:$HOSTPAPA_PASS@$HOSTPAPA_HOST\n        lcd $LOCAL_PATH\n        cd $REMOTE_PATH\n        mirror --reverse --delete --verbose --exclude-glob .git*\n        quit\n    \"\n    \n    if [ $? -eq 0 ]; then\n        echo \"‚úÖ Upload termin√© avec succ√®s!\"\n        echo \"\"\n        echo \"üéâ D√âPLOIEMENT R√âUSSI!\"\n        echo \"üìç Votre site Alt0 est maintenant disponible sur:\"\n        echo \"   https://$HOSTPAPA_HOST\"\n        echo \"\"\n        \n        if [ \"$HOSTING_TYPE\" = \"vps\" ]; then\n            echo \"üõ†Ô∏è Pour un VPS, connectez-vous et ex√©cutez:\"\n            echo \"   cd alt0-app\"\n            echo \"   chmod +x start.sh\"\n            echo \"   ./start.sh\"\n        fi\n    else\n        echo \"‚ùå Erreur lors de l'upload\"\n        echo \"V√©rifiez vos identifiants FTP et r√©essayez\"\n        exit 1\n    fi\n}\n\n# Fonction principale\nmain() {\n    echo \"Alt0 - Clone moderne de Bolt.new\"\n    echo \"D√©ploiement automatique vers HostPapa\"\n    echo \"\"\n    \n    # V√©rifier si on est dans le bon dossier\n    if [ ! -f \"build-for-hostpapa.sh\" ]; then\n        echo \"‚ùå Veuillez ex√©cuter ce script depuis le dossier /app/deploy\"\n        echo \"cd /app/deploy && ./deploy-to-hostpapa.sh\"\n        exit 1\n    fi\n    \n    # √âtapes du d√©ploiement\n    setup_config\n    install_dependencies\n    build_app\n    upload_to_hostpapa\n    \n    echo \"\"\n    echo \"üöÄ D√©ploiement termin√©!\"\n    echo \"üìù Configuration sauvegard√©e dans .env.deploy\"\n    echo \"üîÑ Pour red√©ployer: ./deploy-to-hostpapa.sh --skip-config\"\n}\n\n# Gestion des arguments\nif [ \"$1\" = \"--skip-config\" ] && [ -f \".env.deploy\" ]; then\n    echo \"‚ö° Red√©ploiement rapide...\"\n    install_dependencies\n    build_app\n    upload_to_hostpapa\nelse\n    main\nfi"